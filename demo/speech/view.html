<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Speech</title>

    <link rel="icon" type="image/png">
    <link rel="apple-touch-icon">
    <script>
        function emojiAsFavicon(emoji, x, y) {
            canvas = document.createElement('canvas')
            canvas.height = 32
            canvas.width = 32
            context = canvas.getContext('2d')
            context.font = '28px serif'
            context.fillText(emoji, x, y)
            icon.href = canvas.toDataURL()

            // string = `background:url('${canvas.toDataURL()}')no-repeat;font-size:32px;`
            // console.log(`%c  `, string)
        }

        function emojiAsAppleTouchIcon(emoji, x, y) {
            canvas = document.createElement('canvas')
            canvas.height = 180
            canvas.width = 180
            context = canvas.getContext('2d')
            context.font = '160px serif'
            context.fillText(emoji, x, y)
            appleTouchIcon.href = canvas.toDataURL()
        }

        icon = document.querySelector('link[rel=icon]')
        appleTouchIcon = document.querySelector('link[rel=apple-touch-icon]')
        emojiAsFavicon('üí¨', -4, 28)
        emojiAsAppleTouchIcon('üí¨', 10, 150)
    </script>

    <style>
        * {
            font-family: "Microsoft YaHei";
        }

        body {
            background: #ebebeb;
        }

        textarea {
            background: #ffffff;

            box-sizing: border-box;
            border: 1px #ddd solid;
            outline: none;

            padding: 20px;

            width: 100%;
            height: 40%;
            resize: none;

            font-size: 100%;
            overflow-y: auto;
        }

        .container {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 100px;
        }

        .highlight {
            background-color: wheat
        }

        #tri {
            text-align: center;
            margin-bottom: 2px;
        }

        #triangle {
            display: inline-block;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 10px 5px 0 5px;
            border-color: #FF7799 transparent transparent transparent;
        }

        #output {
            background: #ffffff;
            margin-bottom: 20px;
            padding: 20px;

            box-sizing: border-box;
            border: 1px #ddd solid;
            outline: none;

            width: 100%;
            height: 40%;

            font-size: 100%;
            overflow-y: auto;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #212121;
                color: #bebebe;
            }

            .highlight {
                background-color: darkslateblue
            }

            textarea {
                background: #181818;
                color: #bebebe;
                border: 0;
            }

            #output {
                background: #181818;
                color: #bebebe;
                border: 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <textarea id="textarea" autocomplete="off"></textarea>
        <div id="tri">
            <div id="triangle"></div>
        </div>
        <div id="output"></div>
        <select id="voiceSelect"></select>
        <button id="speak">·êï)‚Åæ‚Åæ Speakk </button>
        <br>
        <label for="rate">Rate</label>
        <input id="rate" type="range" min=0.1 max=10 value=1 step=0.1>
        <span id="rateValue">1</span>
        <br>
        <label for="pitch">Pitch</label>
        <input id="pitch" type="range" min=0 max=2 value=1 step=0.1>
        <span id="pitchValue">1</span>
    </div>
</body>

<script>
    pitch.oninput = function () {
        pitchValue.textContent = pitch.value
    }

    rate.oninput = function () {
        rateValue.textContent = rate.value
    }

    function init() {
        pitchValue.textContent = pitch.value
        rateValue.textContent = rate.value
    }
    onload = init

    voiceList = []

    function populateVoiceList() {
        voiceList = speechSynthesis.getVoices()

        voiceSelect.innerHTML = ''
        selected = false
        language = window.navigator.userLanguage || window.navigator.language
        for (i = 0; i < voiceList.length; i++) {
            option = document.createElement('option')
            option.textContent = `${voiceList[i].name}(${voiceList[i].lang})`
            // safari need toLowerCase
            if (voiceList[i].lang.toLowerCase() === language.toLowerCase()
                && !selected) {
                selected = true
                option.setAttribute('selected', selected)
            }

            option.setAttribute('data-lang', voiceList[i].lang)
            option.setAttribute('data-name', voiceList[i].name)
            voiceSelect.appendChild(option)
        }
    }

    populateVoiceList()
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList
    }

    textarea.placeholder = 'input...'
    textarea.addEventListener('input', (event) => {
        output.innerText = textarea.value
    })
</script>

</html>